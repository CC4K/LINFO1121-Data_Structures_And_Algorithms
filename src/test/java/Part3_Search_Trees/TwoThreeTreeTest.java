package Part3_Search_Trees;

import org.javagrader.Grade;
import org.junit.jupiter.api.Test;

import java.util.Arrays;

import static org.junit.jupiter.api.Assertions.*;

@Grade
public class TwoThreeTreeTest {


    @Test
    @Grade(value = 1, cpuTimeout = 1)
    public void testCompleteDebug() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        int[] keys = new int[]{10, 20, 30, 40, 50, 60};
        for (int v : keys) {
            twoThreeTree.insert(v);
        }
        // The resulting tree is (only showing keys):
        //     [20,40]
        //    /  |   \
        // [10] [30]   [50,60]

        // Check toArray (TODO 1)
        assertArrayEquals(new Integer[]{10, 20, 30, 40, 50, 60}, twoThreeTree.toArray());
        // Check serialize (TODO 2)
        Integer[] expectedSerialization = new Integer[]{2, 20, 40, 1, 10, 1, 30, 2, 50, 60};
        assertArrayEquals(expectedSerialization, twoThreeTree.serialize());

        // Check deserialize (TODO 3)
        assertTrue(nodeEquals(twoThreeTree.getRoot(), new TwoThreeTree(expectedSerialization).getRoot()));

    }

    // -------------- toArray (TODO 1) --------------

    @Test
    @Grade(value = 1, cpuTimeout = 1)
    public void testToArrayEmpty() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        Integer[] serialized = twoThreeTree.serialize();
        assertArrayEquals(new Integer[]{}, serialized);
    }

    @Test
    @Grade(value = 1, cpuTimeout = 1)
    public void testoArraySmall() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        Integer[] keys = new Integer[]{19, 5, 1, 18, 3, 8, 24, 13, 16, 12};
        for (int v : keys) {
            twoThreeTree.insert(v);
        }
        Integer[] expected = new Integer[]{1, 3, 5, 8, 12, 13, 16, 18, 19, 24};
        Integer[] result = twoThreeTree.toArray();
        assertArrayEquals(expected, result);
    }

    @Test
    @Grade(value = 1, cpuTimeout = 1)
    public void testToArrayMedium() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        Integer[] keys = new Integer[]{50, 20, 70, 10, 30, 60, 80, 25, 35, 65, 75, 5, 15, 55, 85, 32, 28, 45, 68, 90};
        for (int v : keys) {
            twoThreeTree.insert(v);
        }
        Integer[] expected = new Integer[]{5, 10, 15, 20, 25, 28, 30, 32, 35, 45, 50, 55, 60, 65, 68, 70, 75, 80, 85, 90};
        Integer[] result = twoThreeTree.toArray();
        assertArrayEquals(expected, result);
    }

    @Test
    @Grade(value = 1, cpuTimeout = 1)
    public void testToArrayLarge() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        Integer[] keys = new Integer[]{966251, 109080, 588241, 488828, 50055, 902084, 101375, 722802, 783501, 883389, 719517, 822942, 239390, 470806, 423012, 230384, 874787, 618303, 174532, 35175, 529801, 954351, 842792, 583316, 958428, 158781, 315425, 725943, 223871, 7439, 199729, 667397, 586501, 830825, 470903, 76555, 795952, 985831, 713010, 168108, 707396, 152582, 994099, 218758, 5318, 567580, 421412, 224691, 795350, 250728, 649774, 681644, 46054, 237508, 674380, 102599, 739158, 537655, 503594, 438497, 37294, 186087, 106553, 967318, 510583, 763499, 292370, 921773, 263990, 171519, 419076, 351121, 862918, 159056, 520188, 304826, 552849, 199992, 673552, 760875, 129003, 488900, 841832, 801364, 363275, 970544, 94409, 572055, 303398, 392116, 914687, 198439, 46953, 613367, 464551, 72141, 965715, 330466, 393174, 28677, 104750, 690384, 32105, 467461, 701096, 454689, 196906, 662749, 657170, 390574, 726044, 18105, 716532, 252246, 663716, 916100, 448586, 412151, 377684, 277863, 899104, 244665, 649812, 173615, 894213, 8836, 217775, 60173, 72175, 380497, 244088, 249974, 420459, 167390, 844823, 829291, 979326, 72379, 456499, 56339, 881438, 249986, 270333, 218820, 797382, 324132, 133527, 55968, 991738, 815581, 101856, 737628, 293207, 822857, 393438, 885596, 976598, 304145, 688454, 973114, 426205, 997502, 819626, 136166, 828097, 552686, 371584, 435559, 142557, 888291, 814858, 58560, 545928, 612665, 316967, 887341, 890037, 859120, 229814, 594765, 599148, 521063, 911587, 107353, 924449, 918570, 145423, 749522, 87470, 657378, 800672, 223801, 389746, 140779, 236450, 126968, 961669, 777731, 828888, 683870, 777879, 701021, 413284, 259848, 764580, 152725, 417038, 293147, 602965, 460863, 72052, 102125, 748983, 578392, 56207, 822979, 33232, 991710, 266141, 517173, 124835, 687739, 124016, 706670, 214338, 595997, 45651, 16016, 122763, 230753, 38292, 507956, 178688, 24237, 809651, 544911, 486983, 918173, 770725, 696688, 216058, 990676, 403909, 601509, 928940, 994357, 573528, 996286, 288314, 685354, 256379, 561321, 996617, 162977, 609836, 418172, 708321, 593175, 273585, 306770, 402981, 826060, 421224, 689484, 662126, 47190, 342572, 205625, 993284, 861714, 899361, 230800, 225336, 430389, 917981, 779610, 306145, 190208, 149043, 816428, 521329, 150738, 850333, 579666, 13299, 841751, 474501, 779912, 287267, 382559, 469424, 423458, 438313, 605257, 448904, 111819, 963380, 923166, 679556, 736874, 845488, 175418, 270006, 617376, 429219, 24932, 850609, 117934, 292329, 953151, 523156, 771252, 343690, 734618, 647160, 689108, 58805, 252386, 128114, 955381, 502300, 379383, 279237, 616995, 569963, 736091, 831335, 122708, 801509, 611335, 872750, 599302, 455198, 752792, 352727, 552323, 272399, 995558, 483571, 622982, 124761, 630581, 319087, 972344, 2137, 960133, 382654, 874195, 732388, 241028, 701157, 418472, 566111, 299236, 346914, 856763, 800638, 43207, 965178, 387980, 554839, 177365, 696798, 919729, 976930, 872944, 663097, 344030, 600463, 951039, 817753, 733319, 662596, 883751, 189879, 70940, 953138, 419096, 26916, 858611, 203347, 743619, 198355, 966532, 356866, 345961, 708925, 351949, 510134, 649103, 637044, 821462, 107868, 270, 559688, 354703, 850577, 12167, 819152, 285525, 606713, 836787, 800854, 988755, 878847, 520664, 967841, 571909, 257705, 441431, 522143, 912600, 36758, 72546, 701423, 985198, 707223, 422860, 163081, 673213, 31784, 885369, 149195, 136727, 389514, 470708, 983136, 277252, 185790, 910303, 67215, 247435, 804191, 294533, 14494, 392784, 567773, 600972, 649440, 26007, 825874, 159686, 411810, 854503, 928258, 779942, 297134, 739529, 432884, 880079, 483962, 922160, 955495, 477640, 569840, 697074, 952051, 759052, 754075, 159476, 246462, 280895, 724075, 553701, 575447, 331002, 660645, 439009, 133426, 521991, 382634, 652917, 219968, 867048, 626337, 733506, 664555, 970258, 374404, 269754, 64491, 801655, 743172, 919368, 324360, 419073, 856794, 281676, 306796, 878682, 841899, 827396, 391588, 743400, 669783, 947270, 911027, 978902, 811231, 863529, 142675, 245902, 289648, 457028, 471049, 286787, 611088, 673806, 58403, 934762, 326564, 476836, 188241, 279688, 861787, 54698, 74206, 699302, 334651, 19145, 365897, 302690, 659782, 362582, 501764, 850144, 240456, 518418, 562184, 365021, 55168, 94030, 992083, 736996, 194089, 577767, 970495, 69785, 61796, 138351, 691072, 6386, 40899, 681836, 169722, 260870, 300340, 705210, 752253, 656509, 234632, 655499, 960990, 588392, 738911, 359695, 829363, 949802, 655346, 624943, 931370, 58067, 408573, 424818, 339270, 958349, 863367, 812547, 309368, 268911, 649487, 230090, 563862, 285551, 760661, 407798, 421050, 929204, 562754, 184540, 609530, 635914, 333236, 185785, 115135, 424431, 844906, 379859, 563268, 47498, 458377, 742270, 475053, 19835, 7945, 823163, 582721, 915021, 57343, 374267, 676550, 525128, 222023, 667521, 622520, 684452, 283405, 733541, 18533, 530264, 256056, 259892, 488744, 983951, 555445, 623861, 907968, 71228, 859995, 727239, 6604, 83204, 715968, 338150, 164453, 254362, 262744, 526988, 138776, 34665, 543236, 625204, 270078, 230442, 60543, 314105, 543546, 711509, 564512, 739165, 896335, 862452, 447692, 331302, 406044, 54546, 676732, 783011, 28724, 452947, 172775, 421453, 181598, 624989, 523660, 291720, 589414, 60404, 176478, 790217, 865182, 431140, 916747, 692625, 783604, 886231, 579819, 545495, 7857, 737798, 591618, 72515, 808908, 144396, 611314, 113111, 91753, 263638, 473280, 129320, 857073, 479287, 284672, 976842, 80142, 13272, 170912, 624587, 152899, 981901, 545423, 837717, 85607, 989186, 585672, 642551, 258876, 438420, 567167, 941693, 301744, 742012, 664230, 574651, 65647, 131110, 902876, 363241, 741347, 639456, 552755, 580456, 878985, 600558, 989404, 475683, 530801, 952634, 65649, 423441, 228754, 845416, 973023, 967894, 956935, 397512, 363502, 371721, 176874, 357093, 447023, 13265, 274380, 831738, 976961, 673448, 903502, 442756, 508863, 310913, 78239, 741171, 600586, 573446, 48658, 559866, 801838, 350138, 103962, 38277, 316979, 74686, 155366, 626378, 761923, 544751, 241299, 937529, 709171, 90412, 398610, 111181, 51375, 121653, 106264, 596100, 607943, 90927, 468283, 240299, 743056, 550404, 208560, 851283, 143288, 848935, 1822, 345888, 312682, 392757, 986270, 180991, 594010, 10743, 414610, 140663, 974509, 875972, 649823, 351321, 674888, 213768, 485714, 801396, 15311, 48680, 620255, 843563, 547635, 310028, 211871, 313538, 986068, 853163, 823812, 21618, 635246, 666050, 375459, 890692, 704630, 729680, 483116, 257305, 128095, 391979, 793907, 469203, 660345, 943934, 334444, 16484, 545523, 853472, 646966, 558449, 978177, 974097, 674638, 261218, 649945, 709075, 709796, 854601, 537751, 273507, 722570, 151852, 581632, 820562, 458505, 310704, 159523, 133317, 111118, 119268, 840923, 256581, 672514, 687016, 804850, 993924, 75255, 946425, 684256, 594541, 246398, 304538, 692081, 799462, 706325, 344607, 807108, 516197, 361853, 498073, 184879, 58412, 278762, 127705, 444160, 20322, 861972, 245539, 322015, 581712, 521067, 993521, 453647, 226101, 430759, 733984, 163923, 954822, 615293, 532987, 875309, 295173, 141677, 8483, 195137, 720444, 86904, 242584, 331225, 19670, 702384, 324006, 254594, 284571, 909735, 979566, 135251, 822470, 672457, 651024, 561485, 803269, 164358, 873202, 816222, 311373, 781223, 311984, 393664, 72471, 92674, 323872, 634302, 71162, 123785, 805184, 390551, 900326, 375036, 544190, 566971, 130170, 375743, 850788, 728434, 276291, 269638, 356127, 525852, 671378, 388652, 982186, 972947, 732281, 62691, 29084, 4012, 118881, 715910, 461770, 499293, 123275, 290187, 34202, 532216, 370849, 392020, 876965, 429398, 969848, 688356, 328072, 236943, 141669, 392302, 855560, 80485, 418873, 197705, 510495, 611264, 308058, 67201, 335271, 395604, 725759, 477767, 638498, 58398, 329095, 232584, 670756, 595662, 262135, 680859, 491677, 585215, 674255, 936979, 680711, 898529, 465351, 942900, 515496, 235000, 424619, 276931, 717700, 330301, 571216, 296566, 832611, 298786, 936306};
        for (int v : keys) {
            twoThreeTree.insert(v);
        }
        Integer[] expected = new Integer[]{270, 1822, 2137, 4012, 5318, 6386, 6604, 7439, 7857, 7945, 8483, 8836, 10743, 12167, 13265, 13272, 13299, 14494, 15311, 16016, 16484, 18105, 18533, 19145, 19670, 19835, 20322, 21618, 24237, 24932, 26007, 26916, 28677, 28724, 29084, 31784, 32105, 33232, 34202, 34665, 35175, 36758, 37294, 38277, 38292, 40899, 43207, 45651, 46054, 46953, 47190, 47498, 48658, 48680, 50055, 51375, 54546, 54698, 55168, 55968, 56207, 56339, 57343, 58067, 58398, 58403, 58412, 58560, 58805, 60173, 60404, 60543, 61796, 62691, 64491, 65647, 65649, 67201, 67215, 69785, 70940, 71162, 71228, 72052, 72141, 72175, 72379, 72471, 72515, 72546, 74206, 74686, 75255, 76555, 78239, 80142, 80485, 83204, 85607, 86904, 87470, 90412, 90927, 91753, 92674, 94030, 94409, 101375, 101856, 102125, 102599, 103962, 104750, 106264, 106553, 107353, 107868, 109080, 111118, 111181, 111819, 113111, 115135, 117934, 118881, 119268, 121653, 122708, 122763, 123275, 123785, 124016, 124761, 124835, 126968, 127705, 128095, 128114, 129003, 129320, 130170, 131110, 133317, 133426, 133527, 135251, 136166, 136727, 138351, 138776, 140663, 140779, 141669, 141677, 142557, 142675, 143288, 144396, 145423, 149043, 149195, 150738, 151852, 152582, 152725, 152899, 155366, 158781, 159056, 159476, 159523, 159686, 162977, 163081, 163923, 164358, 164453, 167390, 168108, 169722, 170912, 171519, 172775, 173615, 174532, 175418, 176478, 176874, 177365, 178688, 180991, 181598, 184540, 184879, 185785, 185790, 186087, 188241, 189879, 190208, 194089, 195137, 196906, 197705, 198355, 198439, 199729, 199992, 203347, 205625, 208560, 211871, 213768, 214338, 216058, 217775, 218758, 218820, 219968, 222023, 223801, 223871, 224691, 225336, 226101, 228754, 229814, 230090, 230384, 230442, 230753, 230800, 232584, 234632, 235000, 236450, 236943, 237508, 239390, 240299, 240456, 241028, 241299, 242584, 244088, 244665, 245539, 245902, 246398, 246462, 247435, 249974, 249986, 250728, 252246, 252386, 254362, 254594, 256056, 256379, 256581, 257305, 257705, 258876, 259848, 259892, 260870, 261218, 262135, 262744, 263638, 263990, 266141, 268911, 269638, 269754, 270006, 270078, 270333, 272399, 273507, 273585, 274380, 276291, 276931, 277252, 277863, 278762, 279237, 279688, 280895, 281676, 283405, 284571, 284672, 285525, 285551, 286787, 287267, 288314, 289648, 290187, 291720, 292329, 292370, 293147, 293207, 294533, 295173, 296566, 297134, 298786, 299236, 300340, 301744, 302690, 303398, 304145, 304538, 304826, 306145, 306770, 306796, 308058, 309368, 310028, 310704, 310913, 311373, 311984, 312682, 313538, 314105, 315425, 316967, 316979, 319087, 322015, 323872, 324006, 324132, 324360, 326564, 328072, 329095, 330301, 330466, 331002, 331225, 331302, 333236, 334444, 334651, 335271, 338150, 339270, 342572, 343690, 344030, 344607, 345888, 345961, 346914, 350138, 351121, 351321, 351949, 352727, 354703, 356127, 356866, 357093, 359695, 361853, 362582, 363241, 363275, 363502, 365021, 365897, 370849, 371584, 371721, 374267, 374404, 375036, 375459, 375743, 377684, 379383, 379859, 380497, 382559, 382634, 382654, 387980, 388652, 389514, 389746, 390551, 390574, 391588, 391979, 392020, 392116, 392302, 392757, 392784, 393174, 393438, 393664, 395604, 397512, 398610, 402981, 403909, 406044, 407798, 408573, 411810, 412151, 413284, 414610, 417038, 418172, 418472, 418873, 419073, 419076, 419096, 420459, 421050, 421224, 421412, 421453, 422860, 423012, 423441, 423458, 424431, 424619, 424818, 426205, 429219, 429398, 430389, 430759, 431140, 432884, 435559, 438313, 438420, 438497, 439009, 441431, 442756, 444160, 447023, 447692, 448586, 448904, 452947, 453647, 454689, 455198, 456499, 457028, 458377, 458505, 460863, 461770, 464551, 465351, 467461, 468283, 469203, 469424, 470708, 470806, 470903, 471049, 473280, 474501, 475053, 475683, 476836, 477640, 477767, 479287, 483116, 483571, 483962, 485714, 486983, 488744, 488828, 488900, 491677, 498073, 499293, 501764, 502300, 503594, 507956, 508863, 510134, 510495, 510583, 515496, 516197, 517173, 518418, 520188, 520664, 521063, 521067, 521329, 521991, 522143, 523156, 523660, 525128, 525852, 526988, 529801, 530264, 530801, 532216, 532987, 537655, 537751, 543236, 543546, 544190, 544751, 544911, 545423, 545495, 545523, 545928, 547635, 550404, 552323, 552686, 552755, 552849, 553701, 554839, 555445, 558449, 559688, 559866, 561321, 561485, 562184, 562754, 563268, 563862, 564512, 566111, 566971, 567167, 567580, 567773, 569840, 569963, 571216, 571909, 572055, 573446, 573528, 574651, 575447, 577767, 578392, 579666, 579819, 580456, 581632, 581712, 582721, 583316, 585215, 585672, 586501, 588241, 588392, 589414, 591618, 593175, 594010, 594541, 594765, 595662, 595997, 596100, 599148, 599302, 600463, 600558, 600586, 600972, 601509, 602965, 605257, 606713, 607943, 609530, 609836, 611088, 611264, 611314, 611335, 612665, 613367, 615293, 616995, 617376, 618303, 620255, 622520, 622982, 623861, 624587, 624943, 624989, 625204, 626337, 626378, 630581, 634302, 635246, 635914, 637044, 638498, 639456, 642551, 646966, 647160, 649103, 649440, 649487, 649774, 649812, 649823, 649945, 651024, 652917, 655346, 655499, 656509, 657170, 657378, 659782, 660345, 660645, 662126, 662596, 662749, 663097, 663716, 664230, 664555, 666050, 667397, 667521, 669783, 670756, 671378, 672457, 672514, 673213, 673448, 673552, 673806, 674255, 674380, 674638, 674888, 676550, 676732, 679556, 680711, 680859, 681644, 681836, 683870, 684256, 684452, 685354, 687016, 687739, 688356, 688454, 689108, 689484, 690384, 691072, 692081, 692625, 696688, 696798, 697074, 699302, 701021, 701096, 701157, 701423, 702384, 704630, 705210, 706325, 706670, 707223, 707396, 708321, 708925, 709075, 709171, 709796, 711509, 713010, 715910, 715968, 716532, 717700, 719517, 720444, 722570, 722802, 724075, 725759, 725943, 726044, 727239, 728434, 729680, 732281, 732388, 733319, 733506, 733541, 733984, 734618, 736091, 736874, 736996, 737628, 737798, 738911, 739158, 739165, 739529, 741171, 741347, 742012, 742270, 743056, 743172, 743400, 743619, 748983, 749522, 752253, 752792, 754075, 759052, 760661, 760875, 761923, 763499, 764580, 770725, 771252, 777731, 777879, 779610, 779912, 779942, 781223, 783011, 783501, 783604, 790217, 793907, 795350, 795952, 797382, 799462, 800638, 800672, 800854, 801364, 801396, 801509, 801655, 801838, 803269, 804191, 804850, 805184, 807108, 808908, 809651, 811231, 812547, 814858, 815581, 816222, 816428, 817753, 819152, 819626, 820562, 821462, 822470, 822857, 822942, 822979, 823163, 823812, 825874, 826060, 827396, 828097, 828888, 829291, 829363, 830825, 831335, 831738, 832611, 836787, 837717, 840923, 841751, 841832, 841899, 842792, 843563, 844823, 844906, 845416, 845488, 848935, 850144, 850333, 850577, 850609, 850788, 851283, 853163, 853472, 854503, 854601, 855560, 856763, 856794, 857073, 858611, 859120, 859995, 861714, 861787, 861972, 862452, 862918, 863367, 863529, 865182, 867048, 872750, 872944, 873202, 874195, 874787, 875309, 875972, 876965, 878682, 878847, 878985, 880079, 881438, 883389, 883751, 885369, 885596, 886231, 887341, 888291, 890037, 890692, 894213, 896335, 898529, 899104, 899361, 900326, 902084, 902876, 903502, 907968, 909735, 910303, 911027, 911587, 912600, 914687, 915021, 916100, 916747, 917981, 918173, 918570, 919368, 919729, 921773, 922160, 923166, 924449, 928258, 928940, 929204, 931370, 934762, 936306, 936979, 937529, 941693, 942900, 943934, 946425, 947270, 949802, 951039, 952051, 952634, 953138, 953151, 954351, 954822, 955381, 955495, 956935, 958349, 958428, 960133, 960990, 961669, 963380, 965178, 965715, 966251, 966532, 967318, 967841, 967894, 969848, 970258, 970495, 970544, 972344, 972947, 973023, 973114, 974097, 974509, 976598, 976842, 976930, 976961, 978177, 978902, 979326, 979566, 981901, 982186, 983136, 983951, 985198, 985831, 986068, 986270, 988755, 989186, 989404, 990676, 991710, 991738, 992083, 993284, 993521, 993924, 994099, 994357, 995558, 996286, 996617, 997502};
        Integer[] result = twoThreeTree.toArray();
        assertArrayEquals(expected, result);
    }

    // -------------- serialize (TODO 2) --------------

    @Test
    @Grade(value = 1, cpuTimeout = 1)
    public void testSerializationEmpty() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        Integer[] serialized = twoThreeTree.serialize();
        assertArrayEquals(new Integer[]{}, serialized);
    }


    @Test
    @Grade(value = 1, cpuTimeout = 1)
    public void testSerializationSmall() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        twoThreeTree.insert(10);
        twoThreeTree.insert(20);
        twoThreeTree.insert(30);
        twoThreeTree.insert(40);
        Integer[] serialized = twoThreeTree.serialize();
        assertArrayEquals(new Integer[]{1, 20, 1, 10, 2, 30, 40}, serialized);
    }


    @Test
    @Grade(value = 1, cpuTimeout = 1)
    public void testSerializationLarge() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        int[] keys = new int[]{19, 5, 1, 18, 3, 8, 24, 13, 16, 12};
        for (int v : keys) {
            twoThreeTree.insert(v);
        }
        Integer[] serialized = twoThreeTree.serialize();
        assertArrayEquals(new Integer[]{1, 13, 1, 5, 2, 1, 3, 2, 8, 12, 1, 18, 1, 16, 2, 19, 24}, serialized);
    }

    // -------------- deserialize (TODO 3) --------------

    @Test
    @Grade(value = 2, cpuTimeout = 1)
    public void testDeserializationSmall() {
        TwoThreeTree tree1 = new TwoThreeTree();
        int[] keys = new int[]{1, 2, 3, 4, 5, 6};
        for (int v : keys) {
            tree1.insert(v);
        }
        Integer[] serialized = new Integer[]{2, 2, 4, 1, 1, 1, 3, 2, 5, 6};
        TwoThreeTree tree2 = new TwoThreeTree(serialized);
        System.out.println(Arrays.toString(tree1.toArray()));
        System.out.println(Arrays.toString(tree2.toArray()));
        assertTrue(nodeEquals(tree1.getRoot(), tree2.getRoot()));
    }



    @Test
    @Grade(value = 2, cpuTimeout = 1)
    public void testDeserializationMedium() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        int[] keys = new int[]{19, 5, 1, 18, 3, 8, 24, 13, 16, 12};
        for (int v : keys) {
            twoThreeTree.insert(v);
        }
        Integer[] serialized = twoThreeTree.serialize();
        assertTrue(serialized.length >= keys.length);
        TwoThreeTree deserializedTree = new TwoThreeTree(serialized);
        assertTrue(nodeEquals(deserializedTree.getRoot(), twoThreeTree.getRoot()));
    }

    @Test
    @Grade(value = 2, cpuTimeout = 1)
    public void testDeserializationLarge() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        Integer[] keys = new Integer[]{966251, 109080, 588241, 488828, 50055, 902084, 101375, 722802, 783501, 883389, 719517, 822942, 239390, 470806, 423012, 230384, 874787, 618303, 174532, 35175, 529801, 954351, 842792, 583316, 958428, 158781, 315425, 725943, 223871, 7439, 199729, 667397, 586501, 830825, 470903, 76555, 795952, 985831, 713010, 168108, 707396, 152582, 994099, 218758, 5318, 567580, 421412, 224691, 795350, 250728, 649774, 681644, 46054, 237508, 674380, 102599, 739158, 537655, 503594, 438497, 37294, 186087, 106553, 967318, 510583, 763499, 292370, 921773, 263990, 171519, 419076, 351121, 862918, 159056, 520188, 304826, 552849, 199992, 673552, 760875, 129003, 488900, 841832, 801364, 363275, 970544, 94409, 572055, 303398, 392116, 914687, 198439, 46953, 613367, 464551, 72141, 965715, 330466, 393174, 28677, 104750, 690384, 32105, 467461, 701096, 454689, 196906, 662749, 657170, 390574, 726044, 18105, 716532, 252246, 663716, 916100, 448586, 412151, 377684, 277863, 899104, 244665, 649812, 173615, 894213, 8836, 217775, 60173, 72175, 380497, 244088, 249974, 420459, 167390, 844823, 829291, 979326, 72379, 456499, 56339, 881438, 249986, 270333, 218820, 797382, 324132, 133527, 55968, 991738, 815581, 101856, 737628, 293207, 822857, 393438, 885596, 976598, 304145, 688454, 973114, 426205, 997502, 819626, 136166, 828097, 552686, 371584, 435559, 142557, 888291, 814858, 58560, 545928, 612665, 316967, 887341, 890037, 859120, 229814, 594765, 599148, 521063, 911587, 107353, 924449, 918570, 145423, 749522, 87470, 657378, 800672, 223801, 389746, 140779, 236450, 126968, 961669, 777731, 828888, 683870, 777879, 701021, 413284, 259848, 764580, 152725, 417038, 293147, 602965, 460863, 72052, 102125, 748983, 578392, 56207, 822979, 33232, 991710, 266141, 517173, 124835, 687739, 124016, 706670, 214338, 595997, 45651, 16016, 122763, 230753, 38292, 507956, 178688, 24237, 809651, 544911, 486983, 918173, 770725, 696688, 216058, 990676, 403909, 601509, 928940, 994357, 573528, 996286, 288314, 685354, 256379, 561321, 996617, 162977, 609836, 418172, 708321, 593175, 273585, 306770, 402981, 826060, 421224, 689484, 662126, 47190, 342572, 205625, 993284, 861714, 899361, 230800, 225336, 430389, 917981, 779610, 306145, 190208, 149043, 816428, 521329, 150738, 850333, 579666, 13299, 841751, 474501, 779912, 287267, 382559, 469424, 423458, 438313, 605257, 448904, 111819, 963380, 923166, 679556, 736874, 845488, 175418, 270006, 617376, 429219, 24932, 850609, 117934, 292329, 953151, 523156, 771252, 343690, 734618, 647160, 689108, 58805, 252386, 128114, 955381, 502300, 379383, 279237, 616995, 569963, 736091, 831335, 122708, 801509, 611335, 872750, 599302, 455198, 752792, 352727, 552323, 272399, 995558, 483571, 622982, 124761, 630581, 319087, 972344, 2137, 960133, 382654, 874195, 732388, 241028, 701157, 418472, 566111, 299236, 346914, 856763, 800638, 43207, 965178, 387980, 554839, 177365, 696798, 919729, 976930, 872944, 663097, 344030, 600463, 951039, 817753, 733319, 662596, 883751, 189879, 70940, 953138, 419096, 26916, 858611, 203347, 743619, 198355, 966532, 356866, 345961, 708925, 351949, 510134, 649103, 637044, 821462, 107868, 270, 559688, 354703, 850577, 12167, 819152, 285525, 606713, 836787, 800854, 988755, 878847, 520664, 967841, 571909, 257705, 441431, 522143, 912600, 36758, 72546, 701423, 985198, 707223, 422860, 163081, 673213, 31784, 885369, 149195, 136727, 389514, 470708, 983136, 277252, 185790, 910303, 67215, 247435, 804191, 294533, 14494, 392784, 567773, 600972, 649440, 26007, 825874, 159686, 411810, 854503, 928258, 779942, 297134, 739529, 432884, 880079, 483962, 922160, 955495, 477640, 569840, 697074, 952051, 759052, 754075, 159476, 246462, 280895, 724075, 553701, 575447, 331002, 660645, 439009, 133426, 521991, 382634, 652917, 219968, 867048, 626337, 733506, 664555, 970258, 374404, 269754, 64491, 801655, 743172, 919368, 324360, 419073, 856794, 281676, 306796, 878682, 841899, 827396, 391588, 743400, 669783, 947270, 911027, 978902, 811231, 863529, 142675, 245902, 289648, 457028, 471049, 286787, 611088, 673806, 58403, 934762, 326564, 476836, 188241, 279688, 861787, 54698, 74206, 699302, 334651, 19145, 365897, 302690, 659782, 362582, 501764, 850144, 240456, 518418, 562184, 365021, 55168, 94030, 992083, 736996, 194089, 577767, 970495, 69785, 61796, 138351, 691072, 6386, 40899, 681836, 169722, 260870, 300340, 705210, 752253, 656509, 234632, 655499, 960990, 588392, 738911, 359695, 829363, 949802, 655346, 624943, 931370, 58067, 408573, 424818, 339270, 958349, 863367, 812547, 309368, 268911, 649487, 230090, 563862, 285551, 760661, 407798, 421050, 929204, 562754, 184540, 609530, 635914, 333236, 185785, 115135, 424431, 844906, 379859, 563268, 47498, 458377, 742270, 475053, 19835, 7945, 823163, 582721, 915021, 57343, 374267, 676550, 525128, 222023, 667521, 622520, 684452, 283405, 733541, 18533, 530264, 256056, 259892, 488744, 983951, 555445, 623861, 907968, 71228, 859995, 727239, 6604, 83204, 715968, 338150, 164453, 254362, 262744, 526988, 138776, 34665, 543236, 625204, 270078, 230442, 60543, 314105, 543546, 711509, 564512, 739165, 896335, 862452, 447692, 331302, 406044, 54546, 676732, 783011, 28724, 452947, 172775, 421453, 181598, 624989, 523660, 291720, 589414, 60404, 176478, 790217, 865182, 431140, 916747, 692625, 783604, 886231, 579819, 545495, 7857, 737798, 591618, 72515, 808908, 144396, 611314, 113111, 91753, 263638, 473280, 129320, 857073, 479287, 284672, 976842, 80142, 13272, 170912, 624587, 152899, 981901, 545423, 837717, 85607, 989186, 585672, 642551, 258876, 438420, 567167, 941693, 301744, 742012, 664230, 574651, 65647, 131110, 902876, 363241, 741347, 639456, 552755, 580456, 878985, 600558, 989404, 475683, 530801, 952634, 65649, 423441, 228754, 845416, 973023, 967894, 956935, 397512, 363502, 371721, 176874, 357093, 447023, 13265, 274380, 831738, 976961, 673448, 903502, 442756, 508863, 310913, 78239, 741171, 600586, 573446, 48658, 559866, 801838, 350138, 103962, 38277, 316979, 74686, 155366, 626378, 761923, 544751, 241299, 937529, 709171, 90412, 398610, 111181, 51375, 121653, 106264, 596100, 607943, 90927, 468283, 240299, 743056, 550404, 208560, 851283, 143288, 848935, 1822, 345888, 312682, 392757, 986270, 180991, 594010, 10743, 414610, 140663, 974509, 875972, 649823, 351321, 674888, 213768, 485714, 801396, 15311, 48680, 620255, 843563, 547635, 310028, 211871, 313538, 986068, 853163, 823812, 21618, 635246, 666050, 375459, 890692, 704630, 729680, 483116, 257305, 128095, 391979, 793907, 469203, 660345, 943934, 334444, 16484, 545523, 853472, 646966, 558449, 978177, 974097, 674638, 261218, 649945, 709075, 709796, 854601, 537751, 273507, 722570, 151852, 581632, 820562, 458505, 310704, 159523, 133317, 111118, 119268, 840923, 256581, 672514, 687016, 804850, 993924, 75255, 946425, 684256, 594541, 246398, 304538, 692081, 799462, 706325, 344607, 807108, 516197, 361853, 498073, 184879, 58412, 278762, 127705, 444160, 20322, 861972, 245539, 322015, 581712, 521067, 993521, 453647, 226101, 430759, 733984, 163923, 954822, 615293, 532987, 875309, 295173, 141677, 8483, 195137, 720444, 86904, 242584, 331225, 19670, 702384, 324006, 254594, 284571, 909735, 979566, 135251, 822470, 672457, 651024, 561485, 803269, 164358, 873202, 816222, 311373, 781223, 311984, 393664, 72471, 92674, 323872, 634302, 71162, 123785, 805184, 390551, 900326, 375036, 544190, 566971, 130170, 375743, 850788, 728434, 276291, 269638, 356127, 525852, 671378, 388652, 982186, 972947, 732281, 62691, 29084, 4012, 118881, 715910, 461770, 499293, 123275, 290187, 34202, 532216, 370849, 392020, 876965, 429398, 969848, 688356, 328072, 236943, 141669, 392302, 855560, 80485, 418873, 197705, 510495, 611264, 308058, 67201, 335271, 395604, 725759, 477767, 638498, 58398, 329095, 232584, 670756, 595662, 262135, 680859, 491677, 585215, 674255, 936979, 680711, 898529, 465351, 942900, 515496, 235000, 424619, 276931, 717700, 330301, 571216, 296566, 832611, 298786, 936306};
        for (int v : keys) {
            twoThreeTree.insert(v);
        }
        Integer[] serialized = twoThreeTree.serialize();
        assertTrue(serialized.length >= keys.length);
        TwoThreeTree deserializedTree = new TwoThreeTree(serialized);
        assertTrue(nodeEquals(deserializedTree.getRoot(), twoThreeTree.getRoot()));
    }


    // Helper function to compare two node and their children
    public boolean nodeEquals(TwoThreeTree.Node node1, TwoThreeTree.Node node2) {

        if (node1 == null && node2 == null) return true;
        if (node1 == null || node2 == null) return false;

        if (node1.n != node2.n) return false;

        for (int i = 0; i < node1.n; i++) {
            if (node1.keys[i] != node2.keys[i]) return false;
        }

        if (node1.isLeaf() != node2.isLeaf()) return false;

        if (!node1.isLeaf()) {
            for (int i = 0; i <= node1.n; i++) {
                if (!nodeEquals(node1.children[i], node2.children[i])) return false;
            }
        }
        return true;
    }

    // -------------- DO NOT READ BELOW --------------

    // Only to make sure you didn't modify the node structure and the insert and contains methods work correctly
    @Test
    @Grade(value = 1, cpuTimeout = 1)
    public void testSimpleInsertContains1() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        int[] keys = new int[]{19, 5, 1, 18, 3, 8, 24, 13, 16, 12};
        int[] nonKeys = new int[]{7, 9, 10, 2, 25};

        for (int v : keys) {
            twoThreeTree.insert(v);
        }
        for (int v : keys) {
            assertTrue(twoThreeTree.contains(v));
        }
        for (int v : nonKeys) {
            assertFalse(twoThreeTree.contains(v));
        }
    }

    @Test
    @Grade(value = 1, cpuTimeout = 1)
    public void testSimpleInsertContains2() {
        TwoThreeTree twoThreeTree = new TwoThreeTree();
        int[] keys = new int[]{1, 3, 5, 8, 12, 13, 16, 18, 19, 24};
        int[] nonKeys = new int[]{7, 9, 10, 2, 25};
        for (int v : keys) {
            twoThreeTree.insert(v);
        }
        for (int v : keys) {
            assertTrue(twoThreeTree.contains(v));
        }
        for (int v : nonKeys) {
            assertFalse(twoThreeTree.contains(v));
        }
    }

}
